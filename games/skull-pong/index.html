<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Skull Pong â€” Afterverse Arcade</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0a0a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
canvas { display: block; max-width: 100vw; max-height: 100vh; object-fit: contain; touch-action: none; }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = 500, H = 700;
canvas.width = W; canvas.height = H;

// Audio
class AudioMgr {
  constructor() {
    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    this.muted = false;
    this.volume = 0.5;
  }
  resume() { if (this.ctx.state === 'suspended') this.ctx.resume(); }
  play(freq, dur, type='square', vol=0.3) {
    if (this.muted) return;
    const o = this.ctx.createOscillator();
    const g = this.ctx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = vol * this.volume;
    g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
    o.connect(g); g.connect(this.ctx.destination);
    o.start(); o.stop(this.ctx.currentTime + dur);
  }
  hitSound() { this.play(400, 0.1, 'square', 0.4); }
  wallSound() { this.play(250, 0.08, 'triangle', 0.3); }
  scoreSound() { this.play(150, 0.4, 'sawtooth', 0.5); }
  startSound() { 
    this.play(330, 0.1); 
    setTimeout(() => this.play(440, 0.1), 100);
    setTimeout(() => this.play(550, 0.15), 200);
  }
  gameOverSound() {
    this.play(200, 0.3, 'sawtooth', 0.5);
    setTimeout(() => this.play(150, 0.3, 'sawtooth', 0.5), 200);
    setTimeout(() => this.play(100, 0.5, 'sawtooth', 0.6), 400);
  }
}
const audio = new AudioMgr();

// Game state
let state = 'title'; // title, countdown, playing, paused, gameover
let countdownTimer = 0;
let countdownNum = 3;

// Scores
const WIN_SCORE = 7;
let playerScore = 0, aiScore = 0;

// Ball
let ball = { x: W/2, y: H/2, vx: 4, vy: 4, r: 12, visualR: 18, speed: 5 };
// Skull animation
let skullAngle = 0;

// Paddles (tombstone shaped)
const PAD_W = 80, PAD_H = 18, PAD_SPEED = 6;
let player = { x: W/2 - PAD_W/2, y: H - 50, w: PAD_W, h: PAD_H };
let ai = { x: W/2 - PAD_W/2, y: 30, w: PAD_W, h: PAD_H };

// Particles
let particles = [];

// Input
let keys = {};
let touchX = null;
document.addEventListener('keydown', e => { keys[e.key] = true; handleKey(e.key); });
document.addEventListener('keyup', e => keys[e.key] = false);
canvas.addEventListener('touchstart', e => { e.preventDefault(); handleTouch(e); });
canvas.addEventListener('touchmove', e => { e.preventDefault(); touchX = e.touches[0].clientX / canvas.offsetWidth * W; });
canvas.addEventListener('touchend', () => touchX = null);
canvas.addEventListener('click', handleClick);

function handleKey(key) {
  if (key === 'm' || key === 'M') { audio.muted = !audio.muted; return; }
  if (state === 'title' && (key === 'e' || key === 'E' || key === ' ')) startGame();
  if (state === 'gameover' && (key === 'e' || key === 'E' || key === ' ')) backToTitle();
  if (state === 'playing' && (key === 'p' || key === 'P' || key === 'Escape')) {
    state = state === 'playing' ? 'paused' : 'playing';
  }
  if (state === 'paused' && (key === 'p' || key === 'P' || key === 'Escape')) state = 'playing';
}
function handleTouch(e) {
  audio.resume();
  touchX = e.touches[0].clientX / canvas.offsetWidth * W;
  if (state === 'title') startGame();
  if (state === 'gameover') backToTitle();
}
function handleClick() {
  audio.resume();
  if (state === 'title') startGame();
  if (state === 'gameover') backToTitle();
}

function startGame() {
  audio.resume();
  audio.startSound();
  playerScore = 0; aiScore = 0;
  resetBall();
  state = 'countdown';
  countdownNum = 3;
  countdownTimer = 0;
}
function backToTitle() { state = 'title'; }

function resetBall() {
  ball.x = W/2; ball.y = H/2;
  const angle = (Math.random() * 0.5 + 0.25) * Math.PI * (Math.random() > 0.5 ? 1 : -1);
  const dir = Math.random() > 0.5 ? 1 : -1;
  ball.vx = Math.sin(angle) * ball.speed;
  ball.vy = Math.cos(angle) * ball.speed * dir;
}

function spawnParticles(x, y, color, count=8) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*6,
      vy: (Math.random()-0.5)*6,
      life: 1,
      color,
      size: Math.random()*4+2
    });
  }
}

// Draw helpers
function drawTombstone(x, y, w, h, color) {
  ctx.save();
  ctx.fillStyle = color;
  ctx.shadowColor = color;
  ctx.shadowBlur = 15;
  // Tombstone shape: rounded top
  ctx.beginPath();
  ctx.moveTo(x, y + h);
  ctx.lineTo(x, y + h*0.4);
  ctx.quadraticCurveTo(x, y, x + w/2, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + h*0.4);
  ctx.lineTo(x + w, y + h);
  ctx.closePath();
  ctx.fill();
  // Cross detail
  ctx.strokeStyle = 'rgba(0,0,0,0.4)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x + w/2, y + 4); ctx.lineTo(x + w/2, y + h - 2);
  ctx.moveTo(x + w*0.3, y + h*0.4); ctx.lineTo(x + w*0.7, y + h*0.4);
  ctx.stroke();
  ctx.restore();
}

function drawSkull(x, y, r) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(skullAngle);
  ctx.font = `${r*2}px serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.shadowColor = '#a855f7';
  ctx.shadowBlur = 20;
  ctx.fillText('ðŸ’€', 0, 0);
  ctx.restore();
}

function drawCenterLine() {
  ctx.setLineDash([10, 10]);
  ctx.strokeStyle = 'rgba(168,85,247,0.3)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, H/2); ctx.lineTo(W, H/2);
  ctx.stroke();
  ctx.setLineDash([]);
}

function drawScore() {
  ctx.font = '48px Creepster';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#a855f7';
  ctx.shadowColor = '#a855f7';
  ctx.shadowBlur = 10;
  ctx.fillText(aiScore, W/2 - 60, H/2 - 20);
  ctx.fillText(playerScore, W/2 + 60, H/2 + 45);
  ctx.shadowBlur = 0;
}

function drawMuteIndicator() {
  ctx.font = '14px monospace';
  ctx.textAlign = 'right';
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  ctx.fillText(audio.muted ? 'ðŸ”‡ M â€” Muted' : 'ðŸ”Š M â€” Sound', W - 10, H - 10);
}

// Title screen
function drawTitle() {
  // Background
  ctx.fillStyle = '#0a0a0a';
  ctx.fillRect(0, 0, W, H);

  // Floating skulls decoration
  const t = Date.now() / 1000;
  for (let i = 0; i < 5; i++) {
    ctx.font = '30px serif';
    ctx.textAlign = 'center';
    ctx.globalAlpha = 0.15;
    ctx.fillText('ðŸ’€', W * (i+1)/6, H/2 + Math.sin(t + i) * 50);
  }
  ctx.globalAlpha = 1;

  // Title
  ctx.font = '64px Creepster';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#a855f7';
  ctx.shadowColor = '#a855f7';
  ctx.shadowBlur = 30;
  ctx.fillText('SKULL PONG', W/2, 200);
  ctx.shadowBlur = 0;

  // Subtitle
  ctx.font = '20px Creepster';
  ctx.fillStyle = '#c084fc';
  ctx.fillText('First to ' + WIN_SCORE + ' wins', W/2, 250);

  // Instructions
  ctx.font = '18px Creepster';
  ctx.fillStyle = '#e9d5ff';
  ctx.fillText('Arrow Keys / Touch to Move', W/2, 380);
  ctx.fillText('M â€” Mute | P â€” Pause', W/2, 410);

  // Start prompt
  const pulse = Math.sin(t * 3) * 0.3 + 0.7;
  ctx.globalAlpha = pulse;
  ctx.font = '32px Creepster';
  ctx.fillStyle = '#f87171';
  ctx.fillText('Press E or Tap to Start', W/2, 500);
  ctx.globalAlpha = 1;

  // Credit
  ctx.font = '16px Creepster';
  ctx.fillStyle = 'rgba(168,85,247,0.6)';
  ctx.fillText('â˜  A JURN Production â˜ ', W/2, H - 30);

  drawMuteIndicator();
}

// Game Over
function drawGameOver() {
  ctx.fillStyle = 'rgba(10,10,10,0.85)';
  ctx.fillRect(0, 0, W, H);

  const winner = playerScore >= WIN_SCORE ? 'YOU WIN!' : 'YOU LOSE!';
  const color = playerScore >= WIN_SCORE ? '#22c55e' : '#f87171';

  ctx.font = '56px Creepster';
  ctx.textAlign = 'center';
  ctx.fillStyle = color;
  ctx.shadowColor = color;
  ctx.shadowBlur = 25;
  ctx.fillText(winner, W/2, 250);
  ctx.shadowBlur = 0;

  ctx.font = '28px Creepster';
  ctx.fillStyle = '#e9d5ff';
  ctx.fillText(`${playerScore} â€” ${aiScore}`, W/2, 320);

  const t = Date.now() / 1000;
  const pulse = Math.sin(t * 3) * 0.3 + 0.7;
  ctx.globalAlpha = pulse;
  ctx.font = '24px Creepster';
  ctx.fillStyle = '#c084fc';
  ctx.fillText('Press E or Tap to Continue', W/2, 420);
  ctx.globalAlpha = 1;

  drawMuteIndicator();
}

// Update
function update() {
  if (state === 'countdown') {
    countdownTimer++;
    if (countdownTimer >= 60) { countdownTimer = 0; countdownNum--; }
    if (countdownNum <= 0) { state = 'playing'; }
    return;
  }
  if (state !== 'playing') return;

  // Player input
  if (keys['ArrowLeft'] || keys['a'] || keys['A']) player.x -= PAD_SPEED;
  if (keys['ArrowRight'] || keys['d'] || keys['D']) player.x += PAD_SPEED;
  if (touchX !== null) {
    const target = touchX - player.w/2;
    player.x += (target - player.x) * 0.15;
  }
  player.x = Math.max(0, Math.min(W - player.w, player.x));

  // AI movement
  const aiTarget = ball.x - ai.w/2;
  const aiSpeed = 3.5 + Math.min(playerScore + aiScore, 10) * 0.15;
  if (ai.x < aiTarget - 10) ai.x += aiSpeed;
  else if (ai.x > aiTarget + 10) ai.x -= aiSpeed;
  ai.x = Math.max(0, Math.min(W - ai.w, ai.x));

  // Ball movement
  ball.x += ball.vx;
  ball.y += ball.vy;
  skullAngle += ball.vx * 0.02;

  // Wall bounce
  if (ball.x - ball.r <= 0 || ball.x + ball.r >= W) {
    ball.vx *= -1;
    ball.x = Math.max(ball.r, Math.min(W - ball.r, ball.x));
    audio.wallSound();
    spawnParticles(ball.x, ball.y, '#7c3aed', 4);
  }

  // Paddle collision â€” player
  if (ball.vy > 0 && ball.y + ball.r >= player.y && ball.y - ball.r <= player.y + player.h &&
      ball.x >= player.x && ball.x <= player.x + player.w) {
    ball.vy = -Math.abs(ball.vy) - 0.2;
    const offset = (ball.x - (player.x + player.w/2)) / (player.w/2);
    ball.vx = offset * 5;
    audio.hitSound();
    spawnParticles(ball.x, player.y, '#22c55e', 6);
  }

  // Paddle collision â€” AI
  if (ball.vy < 0 && ball.y - ball.r <= ai.y + ai.h && ball.y + ball.r >= ai.y &&
      ball.x >= ai.x && ball.x <= ai.x + ai.w) {
    ball.vy = Math.abs(ball.vy) + 0.2;
    const offset = (ball.x - (ai.x + ai.w/2)) / (ai.w/2);
    ball.vx = offset * 5;
    audio.hitSound();
    spawnParticles(ball.x, ai.y + ai.h, '#f87171', 6);
  }

  // Speed cap
  const spd = Math.sqrt(ball.vx*ball.vx + ball.vy*ball.vy);
  const maxSpd = 9;
  if (spd > maxSpd) { ball.vx *= maxSpd/spd; ball.vy *= maxSpd/spd; }

  // Score
  if (ball.y < -20) {
    playerScore++;
    audio.scoreSound();
    spawnParticles(W/2, 0, '#22c55e', 15);
    if (playerScore >= WIN_SCORE) { state = 'gameover'; audio.gameOverSound(); }
    else resetBall();
  }
  if (ball.y > H + 20) {
    aiScore++;
    audio.scoreSound();
    spawnParticles(W/2, H, '#f87171', 15);
    if (aiScore >= WIN_SCORE) { state = 'gameover'; audio.gameOverSound(); }
    else resetBall();
  }

  // Particles
  particles.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    p.life -= 0.03;
    p.vy += 0.1;
  });
  particles = particles.filter(p => p.life > 0);
}

// Render
function render() {
  ctx.fillStyle = '#0a0a0a';
  ctx.fillRect(0, 0, W, H);

  if (state === 'title') { drawTitle(); return; }
  if (state === 'gameover') { drawGameOver(); return; }

  // Game field
  drawCenterLine();
  drawScore();

  // Paddles
  drawTombstone(player.x, player.y, player.w, player.h, '#22c55e');
  drawTombstone(ai.x, ai.y, ai.w, ai.h, '#f87171');

  // Ball
  drawSkull(ball.x, ball.y, ball.visualR);

  // Particles
  particles.forEach(p => {
    ctx.globalAlpha = p.life;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha = 1;

  // Countdown overlay
  if (state === 'countdown') {
    ctx.fillStyle = 'rgba(10,10,10,0.6)';
    ctx.fillRect(0, 0, W, H);
    const colors = ['#22c55e', '#eab308', '#f87171'];
    const scale = 1 + (countdownTimer/60) * 0.5;
    ctx.save();
    ctx.translate(W/2, H/2);
    ctx.scale(scale, scale);
    ctx.font = '80px Creepster';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = colors[3 - countdownNum] || '#f87171';
    ctx.fillText(countdownNum, 0, 0);
    ctx.restore();
  }

  // Paused
  if (state === 'paused') {
    ctx.fillStyle = 'rgba(10,10,10,0.7)';
    ctx.fillRect(0, 0, W, H);
    ctx.font = '48px Creepster';
    ctx.textAlign = 'center';
    ctx.fillStyle = '#a855f7';
    ctx.fillText('PAUSED', W/2, H/2);
    ctx.font = '20px Creepster';
    ctx.fillStyle = '#c084fc';
    ctx.fillText('Press P to Resume', W/2, H/2 + 50);
  }

  drawMuteIndicator();
}

function loop() {
  update();
  render();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>